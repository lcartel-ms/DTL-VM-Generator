# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool: default

steps:

  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: |
        # Write your PowerShell commands here.
        
        Install-Module -Name Az -AllowClobber -Scope CurrentUser -Force
        Install-Module Az.Accounts -Scope CurrentUser -Force
        Install-Module AzureAD

  - task: AzurePowerShell@5
    inputs:
      azureSubscription: 'SP - NTO'
      ScriptType: 'FilePath'
      ScriptPath: 'Create-Vms.ps1'
      ScriptArguments: '-IfExist "Error"'
      azurePowerShellVersion: 'LatestVersion'